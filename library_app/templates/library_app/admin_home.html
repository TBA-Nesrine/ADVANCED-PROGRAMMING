{% extends 'library_app/base_admin.html' %}
{% block content %}

<!-- ================= DASHBOARD STYLES ================= -->
<style>
.dashboard-title {
    font-size: 28px;
    color: #7b3f3f;
    margin-bottom: 5px;
}

.dashboard-subtitle {
    color: #999;
    margin-bottom: 30px;
}

/* KPI cards */
.cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.card {
    background: #fff;
    border-radius: 14px;
    padding: 30px;
    text-align: center;
    box-shadow: 0 15px 35px rgba(0,0,0,0.08);
}

.card h2 {
    font-size: 14px;
    letter-spacing: 1px;
    color: #666;
    margin-bottom: 10px;
    text-transform: uppercase;
}

.card p {
    font-size: 32px;
    font-weight: bold;
    color: #7b3f3f;
}

.card span {
    display: block;
    font-size: 12px;
    color: #999;
    margin-top: 6px;
}

/* Charts */
.charts {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 25px;
    margin-bottom: 30px;
}

.chart-card {
    background: #fff;
    border-radius: 16px;
    padding: 25px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.08);
}

.chart-card h3 {
    margin-bottom: 20px;
    font-size: 16px;
    color: #555;
}

.chart-card.full {
    margin-top: 20px;
}
</style>

<!-- ================= DASHBOARD CONTENT ================= -->

<h1 class="dashboard-title">Admin Dashboard</h1>
<p class="dashboard-subtitle">Overview of your library performance</p>

<!-- KPI CARDS -->
<div class="cards">

    <div class="card">
        <h2>Active Users</h2>
        <p id="activeUsersPct"></p>
        <span>users currently active</span>
    </div>

    <div class="card">
        <h2>User Satisfaction</h2>
        <p id="satisfactionPct"></p>
        <span>positive experience rate</span>
    </div>

    <div class="card">
        <h2>Books Borrowed</h2>
        <p id="borrowedPct"></p>
        <span>of total books</span>
    </div>

    <div class="card">
        <h2>Reviews Completed</h2>
        <p id="reviewsPct"></p>
        <span>submitted by users</span>
    </div>

</div>

<!-- CHARTS -->
<div class="charts">
    <div class="chart-card">
        <h3>Most Borrowed Books</h3>
        <canvas id="borrowedChart"></canvas>
    </div>

    <div class="chart-card">
        <h3>Books by Category</h3>
        <canvas id="categoryChart"></canvas>
    </div>
</div>

<div class="chart-card full">
    <h3>User Activity Trends</h3>
    <canvas id="activityChart"></canvas>
</div>

<!-- ================= SCRIPTS ================= -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* HELPERS */
function rand(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}
function percent(part, total) {
    return Math.round((part / total) * 100);
}

/* BASE DATA (LOGICAL LIMITS) */
const totalUsers   = rand(6, 10);
const activeUsers  = rand(4, totalUsers);

const totalBooks   = rand(12, 20);
const borrowedBooks = rand(6, totalBooks);

const totalReviews = rand(5, 10);
const positiveReviews = rand(4, totalReviews);

/* KPI CALCULATIONS */
document.getElementById("activeUsersPct").innerText =
    percent(activeUsers, totalUsers) + "%";

document.getElementById("borrowedPct").innerText =
    percent(borrowedBooks, totalBooks) + "%";

document.getElementById("reviewsPct").innerText =
    percent(positiveReviews, totalReviews) + "%";

/* Satisfaction is average of activity + reviews */
const satisfaction =
    Math.round(
        (percent(activeUsers, totalUsers) +
         percent(positiveReviews, totalReviews)) / 2
    );

document.getElementById("satisfactionPct").innerText = satisfaction + "%";

/* CHARTS */

/* Most Borrowed Books */
new Chart(document.getElementById('borrowedChart'), {
    type: 'bar',
    data: {
        labels: ['1984', 'Pride & Prejudice', 'The Great Gatsby', 'Brave New World', 'Mockingbird'],
        datasets: [{
            data: [
                rand(5, 20),
                rand(5, 20),
                rand(5, 20),
                rand(5, 20),
                rand(5, 20)
            ],
            backgroundColor: '#6b8e95'
        }]
    },
    options: {
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
    }
});

/* Books by Category */
new Chart(document.getElementById('categoryChart'), {
    type: 'doughnut',
    data: {
        labels: ['Classic', 'Dystopian', 'Romance', 'Coming of Age'],
        datasets: [{
            data: [
                rand(2, 8),
                rand(2, 8),
                rand(2, 8),
                rand(2, 8)
            ],
            backgroundColor: [
                '#6b8e95',
                '#c2a383',
                '#8b4a4a',
                '#999'
            ]
        }]
    }
});

/* User Activity Trends */
new Chart(document.getElementById('activityChart'), {
    type: 'line',
    data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        datasets: [{
            data: [
                rand(40, 70),
                rand(45, 75),
                rand(50, 80),
                rand(55, 85),
                rand(60, 90),
                rand(65, 95)
            ],
            borderColor: '#6b8e95',
            tension: 0.4,
            fill: false
        }]
    }
});
</script>

{% endblock %}

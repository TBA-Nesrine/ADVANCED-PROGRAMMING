{% extends 'library_app/base_admin.html' %}
{% block content %}

<h2>All Users</h2>

<a href="{% url 'admin_add_user' %}">
    <button style="margin-bottom:10px;">Add New User</button>
</a>

<!-- Search Form -->
<form method="get" style="margin-bottom:15px;">
    <input type="text" name="q" placeholder="Search by name or reference ID" 
           value="{{ request.GET.q }}" style="padding:6px 10px; border-radius:6px; border:1px solid #ccc;">
    <button type="submit" style="padding:6px 12px; border:none; background:#007bff; color:white; border-radius:6px;">Search</button>
    {% if request.GET.q %}
        <a href="{% url 'admin_users' %}" style="margin-left:10px; color:#007bff;">Clear</a>
    {% endif %}
</form>

{% if messages %}
<div id="msg-container" style="
    position: fixed;
    top: 20px;
    right: 20px;
    width: 300px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 10px;
">
    {% for message in messages %}
        <div class="msg-item
            {% if 'success' in message.tags %}success
            {% elif 'error' in message.tags %}error
            {% elif 'warning' in message.tags %}warning
            {% else %}info{% endif %}">
            {{ message }}
        </div>
    {% endfor %}
</div>

<style>
.msg-item {
    background: #f0f0f0;
    color: #333;
    padding: 15px 20px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    font-size: 14px;
    font-weight: 500;
    opacity: 0;
    transform: translateY(-20px);
    animation: slideIn 0.5s forwards;
}

.msg-item.success { background: #d4edda; color: #155724; }
.msg-item.error   { background: #f8d7da; color: #721c24; }
.msg-item.info    { background: #d1ecf1; color: #0c5460; }
.msg-item.warning { background: #fff3cd; color: #856404; }

@keyframes slideIn { to { opacity: 1; transform: translateY(0); } }
@keyframes slideOut { to { opacity: 0; transform: translateY(-20px); } }
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const items = document.querySelectorAll("#msg-container .msg-item");
    items.forEach((item, index) => {
        setTimeout(() => { item.style.animation = "slideOut 0.5s forwards"; }, 3000 + index * 200);
        setTimeout(() => item.remove(), 3500 + index * 200);
    });
});
</script>
{% endif %}

<table>
    <tr>
        <th>Reference ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Address</th>
        <th>Status</th>
        <th>Actions</th>
    </tr>

    {% for u in users %}
    <tr>
        <td>{{ u.reference_id }}</td>
        <td>{{ u.user_name }}</td>
        <td>{{ u.email }}</td>
        <td>{{ u.phone_contact }}</td>
        <td>{{ u.user_address }}</td>
        <td>
            {% if u.active %}
                <span style="color:green; font-weight:600;">Active</span>
            {% else %}
                <span style="color:red; font-weight:600;">Inactive</span>
            {% endif %}
        </td>
        <td>
            {% if u.active %}
                <a href="{% url 'deactivate_user' u.reference_id %}">
                    <button style="background:#CC0000;">Deactivate</button>
                </a>
            {% else %}
                <a href="{% url 'activate_user' u.reference_id %}">
                    <button style="background:#009900;">Activate</button>
                </a>
            {% endif %}
        </td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="7">No users found.</td>
    </tr>
    {% endfor %}
</table>

{% endblock %}
